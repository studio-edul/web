<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notion API 테스트</title>
    <style>
        body {
            font-family: 'Noto Sans', sans-serif;
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #000;
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }
        button:hover {
            background: #333;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 4px;
            max-height: 400px;
            overflow-y: auto;
        }
        .error {
            color: red;
        }
        .success {
            color: green;
        }
        pre {
            white-space: pre-wrap;
            word-wrap: break-word;
        }
    </style>
</head>
<body>
    <h1>Notion API 테스트</h1>
    
    <div class="test-section">
        <h2>설정 확인</h2>
        <p id="api-key-info"></p>
        <p id="database-info"></p>
    </div>

    <div class="test-section">
        <h2>데이터베이스 테스트</h2>
        <button onclick="testCV()">CV 데이터 가져오기</button>
        <button onclick="testWORK()">WORK 데이터 가져오기</button>
        <button onclick="testARTWORK()">ARTWORK 데이터 가져오기</button>
        <button onclick="testAll()">모든 데이터 가져오기</button>
        <div id="result" class="result"></div>
    </div>

    <script src="config.js"></script>
    <script src="notion-api.js"></script>
    <script>
        // API 키 및 데이터베이스 ID 확인
        function checkConfig() {
            const apiKey = NOTION_CONFIG.API_KEY;
            const databases = NOTION_CONFIG.DATABASES;
            const apiKeyEl = document.getElementById('api-key-info');
            const databaseEl = document.getElementById('database-info');
            
            // API 키 확인
            if (apiKey === 'YOUR_NOTION_API_KEY_HERE' || !apiKey) {
                apiKeyEl.innerHTML = '<span class="error">❌ API 키가 설정되지 않았습니다. config.js 파일에 API 키를 입력해주세요.</span>';
                return false;
            }
            
            // Notion API 키 형식 확인 (secret_ 또는 ntn_로 시작)
            if (apiKey.startsWith('secret_') || apiKey.startsWith('ntn_')) {
                apiKeyEl.innerHTML = `<span class="success">✅ API 키 형식이 올바릅니다.</span><br>형식: ${apiKey.substring(0, 10)}...`;
            } else {
                apiKeyEl.innerHTML = `<span class="error">⚠️ API 키 형식이 예상과 다릅니다. (secret_ 또는 ntn_로 시작해야 함)</span><br>현재: ${apiKey.substring(0, 20)}...`;
            }
            
            // 데이터베이스 ID 확인
            const dbStatus = [];
            if (databases.CV && databases.CV !== 'YOUR_CV_DATABASE_ID_HERE') {
                dbStatus.push(`✅ CV: ${databases.CV.substring(0, 20)}...`);
            } else {
                dbStatus.push(`❌ CV: 설정되지 않음`);
            }
            if (databases.WORK && databases.WORK !== 'YOUR_WORK_DATABASE_ID_HERE') {
                dbStatus.push(`✅ WORK: ${databases.WORK.substring(0, 20)}...`);
            } else {
                dbStatus.push(`❌ WORK: 설정되지 않음`);
            }
            if (databases.ARTWORK && databases.ARTWORK !== 'YOUR_ARTWORK_DATABASE_ID_HERE') {
                dbStatus.push(`✅ ARTWORK: ${databases.ARTWORK.substring(0, 20)}...`);
            } else {
                dbStatus.push(`❌ ARTWORK: 설정되지 않음`);
            }
            
            databaseEl.innerHTML = dbStatus.join('<br>');
            
            return true;
        }

        function showResult(data, isError = false) {
            const resultEl = document.getElementById('result');
            if (isError) {
                resultEl.innerHTML = `<div class="error"><strong>오류:</strong><pre>${JSON.stringify(data, null, 2)}</pre></div>`;
            } else {
                resultEl.innerHTML = `<div class="success"><strong>성공:</strong><pre>${JSON.stringify(data, null, 2)}</pre></div>`;
            }
        }

        async function testCV() {
            if (!checkConfig()) return;
            const resultEl = document.getElementById('result');
            resultEl.innerHTML = '<div>CV 데이터 가져오는 중...</div>';
            try {
                const data = await getCVData();
                showResult({ 
                    success: true,
                    database: 'CV',
                    results: data.results?.length || 0,
                    data: data 
                });
            } catch (error) {
                showResult({ 
                    success: false,
                    database: 'CV',
                    message: error.message,
                    details: error.stack 
                }, true);
            }
        }

        async function testWORK() {
            if (!checkConfig()) return;
            const resultEl = document.getElementById('result');
            resultEl.innerHTML = '<div>WORK 데이터 가져오는 중...</div>';
            try {
                const data = await getWORKData();
                showResult({ 
                    success: true,
                    database: 'WORK',
                    results: data.results?.length || 0,
                    data: data 
                });
            } catch (error) {
                showResult({ 
                    success: false,
                    database: 'WORK',
                    message: error.message,
                    details: error.stack 
                }, true);
            }
        }

        async function testARTWORK() {
            if (!checkConfig()) return;
            const resultEl = document.getElementById('result');
            resultEl.innerHTML = '<div>ARTWORK 데이터 가져오는 중...</div>';
            try {
                const data = await getARTWORKData();
                showResult({ 
                    success: true,
                    database: 'ARTWORK',
                    results: data.results?.length || 0,
                    data: data 
                });
            } catch (error) {
                showResult({ 
                    success: false,
                    database: 'ARTWORK',
                    message: error.message,
                    details: error.stack 
                }, true);
            }
        }

        async function testAll() {
            if (!checkConfig()) return;
            const resultEl = document.getElementById('result');
            resultEl.innerHTML = '<div>모든 데이터베이스에서 데이터 가져오는 중...</div>';
            try {
                const data = await getAllNotionData();
                showResult({ 
                    success: true,
                    CV: { results: data.CV.results?.length || 0 },
                    WORK: { results: data.WORK.results?.length || 0 },
                    ARTWORK: { results: data.ARTWORK.results?.length || 0 },
                    data: data 
                });
            } catch (error) {
                showResult({ 
                    success: false,
                    message: error.message,
                    details: error.stack 
                }, true);
            }
        }

        // 페이지 로드 시 설정 확인
        window.onload = checkConfig;
    </script>
</body>
</html>

